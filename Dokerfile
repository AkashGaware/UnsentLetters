FROM maven:3.9.6-eclipse-temurin-17 AS build

WORKDIR /app
COPY . .

RUN mvn clean package -DskipTests

FROM eclipse-temurin:17-jdk

RUN mkdir /opt/app
WORKDIR /opt/app

COPY --from=build /app/target/*.war app.war

# Jetty runner needed to serve JSP
ADD https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-runner/9.4.53.v20231009/jetty-runner-9.4.53.v20231009.jar jetty-runner.jar

EXPOSE 8080

CMD ["java", "-jar", "jetty-runner.jar", "--port", "8080", "app.war"]
